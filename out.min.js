var ct;!function(a){function b(a){var b=document.getElementById(a).innerHTML;return Handlebars.compile(b)}window.onload=function(){Handlebars.registerHelper("math",function(a,b,c,d){return arguments.length<4&&(d=c,c=b,b="+"),a=parseFloat(a),c=parseFloat(c),console.log(d),{"+":a+c,"-":a-c,"*":a*c,"/":a/c,"%":a%c}[b]}),Handlebars.logger.log=function(a,b){console.log(a+b)};var c=7,d=Math.floor(window.innerWidth/c),e=Math.floor(window.innerHeight/Math.floor(window.innerHeight/d)),f=Math.floor(window.innerHeight/e),g=e;f--;var h=new a.core.board.FairTileSource(.3,[new a.core.board.value.ValueNumeric(1)],[[new a.core.board.value.ValueFunctionAddition]],0),i=(new a.core.board.FairTileSource(.3,[new a.core.board.value.ValueNumeric(1)],[[new a.core.board.value.ValueFunctionAddition]],0),new a.core.board.FairTileSource(.3,[new a.core.board.value.ValueNumeric(0)],[[new a.core.board.value.ValueFunctionIncrement,new a.core.board.value.ValueFunctionDecrement],[new a.core.board.value.ValueFunctionAddition,new a.core.board.value.ValueFunctionSubtraction],[new a.core.board.value.ValueFunctionMultiplication]],1)),j=new a.core.board.FairTileSource(.25,[new a.core.board.value.ValueNumeric(0),new a.core.board.value.ValueNumeric(1)],[[new a.core.board.value.ValueFunctionAddition,new a.core.board.value.ValueFunctionSubtraction],[new a.core.board.value.ValueFunctionIncrement,new a.core.board.value.ValueFunctionDecrement],[new a.core.board.value.ValueFunctionMultiplication,new a.core.board.value.ValueFunctionAccumulate]],2),k=new a.core.board.FairTileSource(.25,[new a.core.board.value.ValueNumeric(0),new a.core.board.value.ValueNumeric(1)],[[new a.core.board.value.ValueFunctionAddition,new a.core.board.value.ValueFunctionSubtraction],[new a.core.board.value.ValueFunctionIncrement,new a.core.board.value.ValueFunctionDecrement],[new a.core.board.value.ValueFunctionMultiplication,new a.core.board.value.ValueFunctionAddTime]],2),l=new a.core.board.PointsSourceBoardValue,m=(new a.core.board.PointsSourceMaxBoardValue,new a.core.board.PointsSourceAccumulated),n=new a.core.board.PointSourceTime,o=[];o.push(new a.core.home.Level("f2p","You Only Get One(s)","Back button exits",!1,function(b){for(var g=0,i=new a.core.board.Board(c,f,d,e),j=h.create(c*f,1),k=[],m=0;m<i.tilesAcross;m++)for(var n=0;n<i.tilesDown;n++){var o=j[g];g++,o.board=i;var p=new a.core.board.action.ActionDropTile(o,m,n-i.tilesDown,n);k.push(p)}k.push(new a.core.board.action.ActionScoreUpdated);var q=new a.core.board.BoardGameState(b,i,h,l);return{gameState:q,actions:k}})),o.push(new a.core.home.Level("scant","Scant Rewards","",!0,function(b){for(var g=0,h=new a.core.board.Board(c,f,d,e),j=i.create(c*f,10),k=[],m=0;m<h.tilesAcross;m++)for(var n=0;n<h.tilesDown;n++){var o=j[g];g++,o.board=h;var p=new a.core.board.action.ActionDropTile(o,m,n-h.tilesDown,n);k.push(p)}k.push(new a.core.board.action.ActionScoreUpdated);var q=new a.core.board.BoardGameState(b,h,i,l);return{gameState:q,actions:k}})),o.push(new a.core.home.Level("acc","Accumulater","*(acc)umulate score",!0,function(b){for(var g=0,h=new a.core.board.Board(c,f,d,e),i=j.create(c*f,1),k=[],l=0;l<h.tilesAcross;l++)for(var n=0;n<h.tilesDown;n++){var o=i[g];g++,o.board=h;var p=new a.core.board.action.ActionDropTile(o,l,n-h.tilesDown,n);k.push(p)}k.push(new a.core.board.action.ActionScoreUpdated);var q=new a.core.board.BoardGameState(b,h,j,m);return{gameState:q,actions:k}})),o.push(new a.core.home.Level("timer","Count Down","first move starts timer",!0,function(b){for(var g=0,h=new a.core.board.Board(c,f,d,e),i=j.create(c*f,1),k=[],l=0;l<h.tilesAcross;l++)for(var n=0;n<h.tilesDown;n++){var o=i[g];g++,o.board=h;var p=new a.core.board.action.ActionDropTile(o,l,n-h.tilesDown,n);k.push(p)}k.push(new a.core.board.action.ActionScoreUpdated);var q=new a.core.board.BoardGameState(b,h,j,m,12e4);return{gameState:q,actions:k}})),o.push(new a.core.home.Level("alive","Stayin' Alive","time is score",!0,function(b){for(var g=0,h=new a.core.board.Board(c,f,d,e),i=k.create(c*f,1),j=[],l=0;l<h.tilesAcross;l++)for(var m=0;m<h.tilesDown;m++){var o=i[g];g++,o.board=h;var p=new a.core.board.action.ActionDropTile(o,l,m-h.tilesDown,m);j.push(p)}j.push(new a.core.board.action.ActionScoreUpdated);var q=new a.core.board.BoardGameState(b,h,k,n,12e4);return{gameState:q,actions:j}}));var p=new a.core.home.HomeGameState(o),q=new a.core.render.board.BoardGameStateRenderer(b("board"),{headerHeight:g,windowWidth:window.innerWidth,windowHeight:window.innerHeight},window.location.pathname,g,p),r=new a.core.render.home.HomeGameStateRenderer(b("home"),{},window.location.pathname,window.innerWidth,window.innerHeight),s=b("tile");Handlebars.registerPartial("tile",s);var t=b("animate-action-drop"),u=b("animate-attribute"),v=null,w=function(b,c){var d=null;d=b instanceof a.core.board.BoardGameState?q:r;var e=document.getElementById("content");null!=v&&v.stop(),v=d.render(b,e);var f=new a.core.render.HardcodedActionRendererFactory("#DDDDDD","#DDFFDD","#FFDDDD","#FFDDFF","#888888",s,u,t);for(var g in c){var h=c[g];h.perform(b);var i=f.getActionRenderer(h);i.render(h,b,e,!0)}v.start(function(a){var c=!1;for(var d in a){var g,h=a[d],i=h.perform(b);if(null!=i){var j=i.gameState,k=i.actions;if(j!=b&&null!=j)c||(g=function(){w(j,k)},c=!0);else for(var l in k){var m=k[l];a.push(m)}}var n=f.getActionRenderer(h);null!=n?n.render(h,b,e,!0,g):null!=g&&g()}})},x=function(a){null!=a&&a.length>0&&"#"==a.charAt(0)&&(a=a.substring(1));var b,c,d=null;for(var e in o){var f=o[e];if(f.id==a){d=f;break}}if(null!=d){var g=d.gameStateFactory(d);b=g.gameState,c=g.actions}else b=p,c=[];w(b,c)};window.onhashchange=function(){var a=window.location.hash;x(a)},x(window.location.hash)}}(ct||(ct={}));var ct;!function(a){!function(a){var b=function(){function a(a,b){this.x=a,this.y=b}return a}();a.Point=b}(a.core||(a.core={}));a.core}(ct||(ct={}));var ct;!function(a){!function(a){!function(a){var b=function(){function a(b,c,d,e){this.tilesAcross=b,this.tilesDown=c,this.tileWidth=d,this.tileHeight=e,this.id="board-"+a._boardId,a._boardId++,this.tiles=new Array;for(var f=0;b>f;f++){for(var g=new Array,h=0;c>h;h++)g.push(null);this.tiles.push(g)}}return a.prototype.setTile=function(a,b,c){a.position.x=b,a.position.y=c,a.board=this,this.tiles[b][c]=a},a._boardId=0,a}();a.Board=b}(a.board||(a.board={}));a.board}(a.core||(a.core={}));a.core}(ct||(ct={}));var ct;!function(a){!function(a){!function(a){var b=function(){function a(a,b,c,d,e){this.level=a,this.board=b,this.tileSource=c,this.pointsSource=d,this.gameplayMilliseconds=e,this.selectedTileChain=[],this.startTime=null,this.accumulatedPoints=0}return a.prototype.getId=function(){return this.level.id},a.prototype.getName=function(){return this.level.name},Object.defineProperty(a.prototype,"millisecondsRemaining",{get:function(){var a;return a=null!=this.gameplayMilliseconds?null!=this.startTime?this.gameplayMilliseconds-((new Date).getTime()-this.startTime.getTime()):this.gameplayMilliseconds:null},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"secondsRemainingFormatted",{get:function(){var a=this.millisecondsRemaining;return this.getSecondsRemainingFormatted(a)},enumerable:!0,configurable:!0}),a.prototype.getSecondsRemainingFormatted=function(a){var b;if(null!=a){var c=a/1e3,d=Math.floor(c/60);c%=60,b=""+c;var e=b.indexOf(".");if(0>e?(e=b.length,b+=".0"):b=b.substring(0,e+2),d>0){for(;2>e;)b="0"+b,e++;b=""+d+":"+b}}else b=null;return b},a.prototype.getAccumulatedPoints=function(){return 0},a}();a.BoardGameState=b}(a.board||(a.board={}));a.board}(a.core||(a.core={}));a.core}(ct||(ct={}));var ct;!function(a){!function(b){!function(b){var c=function(){function b(a,b,c,d){this.fairRatio=a,this.normalValues=b,this.symbolValues=c,this.cruelty=d}return b.prototype.create=function(a,b){null==b&&(b=0);var c=Math.floor(a*this.fairRatio);return this.createQuantity(a-c,c,b)},b.prototype.createQuantity=function(b,c,d){for(var e=[],f=0;b>f;f++){var g=Math.abs(2*this.rand(d)-1),h=Math.floor(g*this.normalValues.length),i=this.normalValues[h],j=new a.core.board.Tile(i);e.push(j)}for(var f=0;c>f;f++){var g=Math.abs(2*this.rand(d)-1),h=Math.floor(g*this.symbolValues.length),k=Math.floor(Math.random()*e.length),l=this.symbolValues[h],m=Math.floor(Math.random()*l.length),i=l[m],j=new a.core.board.Tile(i);e.splice(k,0,j)}return e},b.prototype.replace=function(b,c){for(var d=b.tilesAcross*b.tilesDown-c.length,e=0,f=this.cruelty,g=0;g<b.tilesAcross;g++)for(var h=0;h<b.tilesDown;h++){var i=b.tiles[g][h];c.indexOf(i)<0&&(i.value instanceof a.core.board.value.ValueNumeric||e++)}for(var j=e/d,k=0,l=0;l<c.length;l++){var m=this.rand(this.cruelty);2*m*j<this.fairRatio&&k++}return this.createQuantity(Math.max(c.length-k,0),k,Math.max(f,0))},b.prototype.rand=function(a){for(var b=Math.random(),c=0;a>c;c++)b+=Math.random();return b/(a+1)},b}();b.FairTileSource=c}(b.board||(b.board={}));b.board}(a.core||(a.core={}));a.core}(ct||(ct={}));var ct;!function(a){!function(a){!function(a){var b=function(){function a(){this.name="accumulated"}return a.prototype.getPoints=function(a){return a.accumulatedPoints},a}();a.PointsSourceAccumulated=b}(a.board||(a.board={}));a.board}(a.core||(a.core={}));a.core}(ct||(ct={}));var ct;!function(a){!function(b){!function(b){var c=function(){function b(){this.name="maximum value"}return b.prototype.getPoints=function(b){for(var c=null,d=b.board,e=0;e<d.tilesAcross;e++)for(var f=0;f<d.tilesDown;f++){var g=d.tiles[e][f];if(g.value instanceof a.core.board.value.ValueNumeric){var h=g.value,i=h.value;c=null==c?i:Math.max(c,i)}}return c},b}();b.PointsSourceMaxBoardValue=c}(b.board||(b.board={}));b.board}(a.core||(a.core={}));a.core}(ct||(ct={}));var ct;!function(a){!function(a){!function(a){var b=function(){function a(){this.name="time"}return a.prototype.getPoints=function(a){var b,c=a.startTime;return b=null!=c?Math.floor(((new Date).getTime()-c.getTime())/1e3):0},a}();a.PointSourceTime=b}(a.board||(a.board={}));a.board}(a.core||(a.core={}));a.core}(ct||(ct={}));var ct;!function(a){!function(b){!function(b){var c=function(){function b(){this.name="board value"}return b.prototype.getPoints=function(b){for(var c=0,d=b.board,e=0;e<d.tilesAcross;e++)for(var f=0;f<d.tilesDown;f++){var g=d.tiles[e][f];if(g.value instanceof a.core.board.value.ValueNumeric){var h=g.value;c+=h.value}}return c},b}();b.PointsSourceBoardValue=c}(b.board||(b.board={}));b.board}(a.core||(a.core={}));a.core}(ct||(ct={}));var ct;!function(a){!function(b){!function(b){var c=function(){function b(c){this.value=c,this.id="tile-"+b._tileId,b._tileId++,this.position=new a.core.Point,this.symbol=c.toString(),this.selectionState=0}return b._tileId=0,b}();b.Tile=c}(b.board||(b.board={}));b.board}(a.core||(a.core={}));a.core}(ct||(ct={}));var ct;!function(a){!function(a){!function(a){!function(a){a[a.UNSELECTED=0]="UNSELECTED",a[a.INVALID=1]="INVALID",a[a.VALID=2]="VALID",a[a.EXTRANEOUS=3]="EXTRANEOUS",a[a.BAD_PARAMETER=4]="BAD_PARAMETER"}(a.TileSelectionState||(a.TileSelectionState={}));a.TileSelectionState}(a.board||(a.board={}));a.board}(a.core||(a.core={}));a.core}(ct||(ct={}));var ct;!function(a){!function(a){!function(a){!function(a){var b=function(){function a(a,b,c){this.tile=a,this.x=b,this.y=c,a.position.x=b,a.position.y=c}return a.prototype.getPrimaryId=function(){return this.tile.id},a.prototype.perform=function(a){var b=a,c=b.board;return c.setTile(this.tile,this.x,this.y),null},a}();a.ActionCreateTile=b}(a.action||(a.action={}));a.action}(a.board||(a.board={}));a.board}(a.core||(a.core={}));a.core}(ct||(ct={}));var ct;!function(a){!function(a){!function(a){!function(a){var b=function(){function a(a){this.tile=a}return a.prototype.getPrimaryId=function(){return this.tile.id},a.prototype.perform=function(a){var b=a,c=b.selectedTileChain.indexOf(this.tile);return c>=0&&b.selectedTileChain.splice(c,1),this.tile.selectionState=0,null},a}();a.ActionDeselectTile=b}(a.action||(a.action={}));a.action}(a.board||(a.board={}));a.board}(a.core||(a.core={}));a.core}(ct||(ct={}));var ct;!function(a){!function(a){!function(a){!function(a){var b=function(){function a(a){this.tile=a}return a.prototype.getPrimaryId=function(){return this.tile.id},a.prototype.perform=function(a){var b=a,c=b.board,d=this.tile.position;return c.tiles[d.x][d.y]=null,null},a}();a.ActionDestroyTile=b}(a.action||(a.action={}));a.action}(a.board||(a.board={}));a.board}(a.core||(a.core={}));a.core}(ct||(ct={}));var ct;!function(a){!function(a){!function(a){!function(a){var b=function(){function a(a,b,c,d){this.tile=a,this.column=b,this.fromRow=c,this.toRow=d,this.dRow=d-c}return a.prototype.getPrimaryId=function(){return this.tile.id},a.prototype.perform=function(a){var b=a,c=b.board;return this.fromRow>=0&&c.tiles[this.column][this.fromRow]==this.tile&&(c.tiles[this.column][this.fromRow]=null),c.setTile(this.tile,this.column,this.toRow),null},a}();a.ActionDropTile=b}(a.action||(a.action={}));a.action}(a.board||(a.board={}));a.board}(a.core||(a.core={}));a.core}(ct||(ct={}));var ct;!function(a){!function(a){!function(a){!function(a){var b=function(){function a(a,b){this.score=a,this.boardGameState=b}return a.prototype.getPrimaryId=function(){return this.boardGameState.board.id},a.prototype.perform=function(a){var b=a;return b.accumulatedPoints+=this.score,null},a}();a.ActionScoreAccumulated=b}(a.action||(a.action={}));a.action}(a.board||(a.board={}));a.board}(a.core||(a.core={}));a.core}(ct||(ct={}));var ct;!function(a){!function(a){!function(a){!function(a){var b=function(){function a(){}return a.prototype.getPrimaryId=function(){return null},a.prototype.perform=function(a){var b=a,c=b.pointsSource.getPoints(b);return b.level.highScore=null==b.level.highScore?c:Math.max(c,b.level.highScore),null},a}();a.ActionScoreUpdated=b}(a.action||(a.action={}));a.action}(a.board||(a.board={}));a.board}(a.core||(a.core={}));a.core}(ct||(ct={}));var ct;!function(a){!function(a){!function(a){!function(a){var b=function(){function a(a,b){this.tile=a,this.newSelectionState=b,this.originalSelectionState=a.selectionState}return a.prototype.getPrimaryId=function(){return this.tile.id},a.prototype.perform=function(){return this.tile.selectionState=this.newSelectionState,null},a}();a.ActionSetTileSelectionState=b}(a.action||(a.action={}));a.action}(a.board||(a.board={}));a.board}(a.core||(a.core={}));a.core}(ct||(ct={}));var __extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},ct;!function(a){!function(b){!function(b){!function(b){var c=function(a){function b(b,c){a.call(this,b,c)}return __extends(b,a),b.prototype.perform=function(b){var c=b,d=c.selectedTileChain;return d.push(this.tile),a.prototype.perform.call(this,b)},b}(a.core.board.action.ActionSetTileSelectionState);b.ActionSelectTile=c}(b.action||(b.action={}));b.action}(b.board||(b.board={}));b.board}(a.core||(a.core={}));a.core}(ct||(ct={}));var ct;!function(a){!function(a){!function(a){!function(a){var b=function(){function a(a,b,c,d,e){this.secondsRemainingFormatted=a,this.boardGameState=b,this.bonusTime=c,this.startTime=d,this.gameState=e}return a.prototype.getPrimaryId=function(){return this.boardGameState.board.id},a.prototype.perform=function(a){var b=a;return this.bonusTime&&(b.gameplayMilliseconds+=this.bonusTime),this.startTime&&(b.startTime=this.startTime),{gameState:this.gameState,actions:[]}},a}();a.ActionTimeRemainingUpdated=b}(a.action||(a.action={}));a.action}(a.board||(a.board={}));a.board}(a.core||(a.core={}));a.core}(ct||(ct={}));var ct;!function(a){!function(b){!function(b){!function(b){var c=function(){function b(a,b,c){this.evalReturnsNumber=a,this.numberOfParams=b,this.stringRepresentation=c}return b.prototype.eval=function(){return null},b.prototype.terminate=function(b,c,d){var e=b[0],f=new a.core.board.Tile(new a.core.board.value.ValueNumeric(d));return[new a.core.board.action.ActionCreateTile(f,e.position.x,e.position.y)]},b.prototype.toString=function(){return this.stringRepresentation},b}();b.AbstractValue=c}(b.value||(b.value={}));b.value}(b.board||(b.board={}));b.board}(a.core||(a.core={}));a.core}(ct||(ct={}));var ct;!function(a){!function(b){!function(b){!function(b){var c=function(a){function b(){a.call(this,!0,1,"abs")}return __extends(b,a),b.prototype.eval=function(a){return Math.abs(a[0])},b}(a.core.board.value.AbstractValue);b.ValueFunctionAbs=c}(b.value||(b.value={}));b.value}(b.board||(b.board={}));b.board}(a.core||(a.core={}));a.core}(ct||(ct={}));var ct;!function(a){!function(b){!function(b){!function(b){var c=function(b){function c(){b.call(this,!1,1,"acc")}return __extends(c,b),c.prototype.eval=function(a){return a[0]},c.prototype.terminate=function(b,c,d){return[new a.core.board.action.ActionScoreAccumulated(d,c)]},c}(a.core.board.value.AbstractValue);b.ValueFunctionAccumulate=c}(b.value||(b.value={}));b.value}(b.board||(b.board={}));b.board}(a.core||(a.core={}));a.core}(ct||(ct={}));var ct;!function(a){!function(b){!function(b){!function(b){var c=function(b){function c(){b.call(this,!1,1,"tim")}return __extends(c,b),c.prototype.eval=function(a){return a[0]},c.prototype.terminate=function(b,c,d){var e=c.millisecondsRemaining;null!=e&&(e+=1e4*d);var f=c.getSecondsRemainingFormatted(e);return[new a.core.board.action.ActionTimeRemainingUpdated(f,c,1e3*d)]},c}(a.core.board.value.AbstractValue);b.ValueFunctionAddTime=c}(b.value||(b.value={}));b.value}(b.board||(b.board={}));b.board}(a.core||(a.core={}));a.core}(ct||(ct={}));var ct;!function(a){!function(b){!function(b){!function(b){var c=function(a){function b(){a.call(this,!0,2,"+")}return __extends(b,a),b.prototype.eval=function(a){var b=0;for(var c in a){var d=a[c];b+=d}return b},b}(a.core.board.value.AbstractValue);b.ValueFunctionAddition=c}(b.value||(b.value={}));b.value}(b.board||(b.board={}));b.board}(a.core||(a.core={}));a.core}(ct||(ct={}));var ct;!function(a){!function(b){!function(b){!function(b){var c=function(a){function b(){a.call(this,!0,1,"--")}return __extends(b,a),b.prototype.eval=function(a){return a[0]-1},b}(a.core.board.value.AbstractValue);b.ValueFunctionDecrement=c}(b.value||(b.value={}));b.value}(b.board||(b.board={}));b.board}(a.core||(a.core={}));a.core}(ct||(ct={}));var ct;!function(a){!function(b){!function(b){!function(b){var c=function(a){function b(){a.call(this,!0,1,"++")}return __extends(b,a),b.prototype.eval=function(a){return a[0]+1},b}(a.core.board.value.AbstractValue);b.ValueFunctionIncrement=c}(b.value||(b.value={}));b.value}(b.board||(b.board={}));b.board}(a.core||(a.core={}));a.core}(ct||(ct={}));var ct;!function(a){!function(b){!function(b){!function(b){var c=function(a){function b(){a.call(this,!0,2,"*")}return __extends(b,a),b.prototype.eval=function(a){var b=1;for(var c in a){var d=a[c];b*=d}return b},b}(a.core.board.value.AbstractValue);b.ValueFunctionMultiplication=c}(b.value||(b.value={}));b.value}(b.board||(b.board={}));b.board}(a.core||(a.core={}));a.core}(ct||(ct={}));var ct;!function(a){!function(b){!function(b){!function(b){var c=function(a){function b(){a.call(this,!0,1,"neg")}return __extends(b,a),b.prototype.eval=function(a){return-a[0]},b}(a.core.board.value.AbstractValue);b.ValueFunctionNegate=c}(b.value||(b.value={}));b.value}(b.board||(b.board={}));b.board}(a.core||(a.core={}));a.core}(ct||(ct={}));var ct;!function(a){!function(b){!function(b){!function(b){var c=function(a){function b(){a.call(this,!0,2,"-")}return __extends(b,a),b.prototype.eval=function(a){for(var b=a[0],c=1;c<a.length;c++){var d=a[c];b-=d}return b},b}(a.core.board.value.AbstractValue);b.ValueFunctionSubtraction=c}(b.value||(b.value={}));b.value}(b.board||(b.board={}));b.board}(a.core||(a.core={}));a.core}(ct||(ct={}));var ct;!function(a){!function(b){!function(b){!function(b){var c=function(a){function b(b){a.call(this,!0,0,""+b),this.value=b}return __extends(b,a),b.prototype.eval=function(){return this.value},b}(a.core.board.value.AbstractValue);b.ValueNumeric=c}(b.value||(b.value={}));b.value}(b.board||(b.board={}));b.board}(a.core||(a.core={}));a.core}(ct||(ct={}));var ct;!function(a){!function(a){!function(a){var b=function(){function a(a){this.levels=a}return a.prototype.getId=function(){return""},a.prototype.getName=function(){return"Code Tower"},a}();a.HomeGameState=b}(a.home||(a.home={}));a.home}(a.core||(a.core={}));a.core}(ct||(ct={}));var ct;!function(a){!function(b){!function(b){var c=function(){function b(b,c,d,e,f){this.id=b,this.name=c,this.description=d,this.locked=e,this.gameStateFactory=f,this.highScore=null,this.position=new a.core.Point}return b}();b.Level=c}(b.home||(b.home={}));b.home}(a.core||(a.core={}));a.core}(ct||(ct={}));var ct;!function(a){!function(a){!function(a){!function(a){var b=function(){function a(a){this.level=a}return a.prototype.getPrimaryId=function(){return this.level.id},a.prototype.perform=function(){return this.level.gameStateFactory(this.level)},a}();a.ActionLevelSelect=b}(a.action||(a.action={}));a.action}(a.home||(a.home={}));a.home}(a.core||(a.core={}));a.core}(ct||(ct={}));var ct;!function(a){!function(a){!function(a){var b=function(){function a(a,b,c){this.template=a,this.params=b,this.baseUrl=c}return a.prototype.render=function(a,b){this.params.gameState=a,this.doRender(a,b,this.params);var c=a.getId();return window.history.pushState(c,a.getName(),this.baseUrl+"#"+c),null},a.prototype.doRender=function(a,b,c){var d=this.template(c);b.innerHTML=d},a}();a.HandlebarsGameStateRenderer=b}(a.render||(a.render={}));a.render}(a.core||(a.core={}));a.core}(ct||(ct={}));var ct;!function(a){!function(a){!function(a){var b=function(){function a(a,b){this.template=a,this.params=b}return a.prototype.render=function(b,c,d,e,f){var g=this,h=this.findOrCreateTarget(b,c,d);if(e){var i="anim-"+a._animationId;a._animationId++,this.params.gameState=c,this.params.action=b,this.params.animationId=i,this.adjustParams(b,c,this.params);var j=this.template(this.params),k=this.parseSVG(j,i);k.addEventListener("endEvent",function(){g.setToFinalState(b,c,h),h.removeChild(k),f&&f(b,c)}),h.appendChild(k),k.beginElement()}else this.setToFinalState(b,c,h),f&&f(b,c)},a.prototype.adjustParams=function(){},a.prototype.setToFinalState=function(){},a.prototype.findOrCreateTarget=function(a,b,c){return c},a.prototype.parseSVG=function(a,b){var c=document.createElementNS("http://www.w3.org/1999/xhtml","div");return c.innerHTML='<svg xmlns="http://www.w3.org/2000/svg">'+a+"</svg>",$(c).find("#"+b).get(0)},a._animationId=0,a}();a.HandlebarsSVGAnimationActionRenderer=b}(a.render||(a.render={}));a.render}(a.core||(a.core={}));a.core}(ct||(ct={}));var ct;!function(a){!function(b){!function(b){var c=function(a){function b(b,c,d,e,f,g,h){a.call(this,b,g),this.attributeName=c,this.startValue=d,this.endValue=e,this.idPostfix=f,this.removeAllWhenDone=h}return __extends(b,a),b.prototype.adjustParams=function(a,b,c){c.from=this.startValue,c.to=this.endValue,c.attributeName=this.attributeName},b.prototype.setToFinalState=function(a,b,c){{var d=b,e=a,f=d.board;e.column*f.tileWidth,e.toRow*f.tileHeight}c.setAttribute(this.attributeName,this.endValue),this.removeAllWhenDone&&c.parentNode.removeChild(c)},b.prototype.findOrCreateTarget=function(a,b){var c=b,d=(c.board,a.getPrimaryId()+this.idPostfix),e=document.getElementById(d);return e},b}(a.core.render.HandlebarsSVGAnimationActionRenderer);b.HandlebarsSVGAnimationAttributeActionRenderer=c}(b.render||(b.render={}));b.render}(a.core||(a.core={}));a.core}(ct||(ct={}));var ct;!function(a){!function(b){!function(b){var c=function(){function b(b,c,d,e,f,g,h,i){this.selectTileActionRenderer=new a.core.render.board.HandlebarsSVGAnimationActionSetTileSelectionStateRenderer(h,b,c,d,e,f,"-bg",{}),this.dropTileActionRenderer=new a.core.render.board.HandlebarsSVGAnimationActionDropTileRenderer(i,g,b,{}),this.destroyTileActionRenderer=new a.core.render.HandlebarsSVGAnimationAttributeActionRenderer(h,"opacity","1","0","",{},!0),this.createTileActionRenderer=new a.core.render.board.HandlebarsSVGAnimationActionCreateTileRenderer(h,g,b,{}),this.actionTimeRemainingUpdatedRenderer=new a.core.render.board.action.ActionTimeRemainingUpdatedRenderer,this.actionUpdatePointsRenderer=new a.core.render.board.action.ActionUpdatePointsRenderer}return b.prototype.getActionRenderer=function(b){var c;return c=b instanceof a.core.board.action.ActionDeselectTile||b instanceof a.core.board.action.ActionSelectTile||b instanceof a.core.board.action.ActionSetTileSelectionState?this.selectTileActionRenderer:b instanceof a.core.board.action.ActionDropTile?this.dropTileActionRenderer:b instanceof a.core.board.action.ActionCreateTile?this.createTileActionRenderer:b instanceof a.core.board.action.ActionDestroyTile?this.destroyTileActionRenderer:b instanceof a.core.board.action.ActionTimeRemainingUpdated?this.actionTimeRemainingUpdatedRenderer:b instanceof a.core.board.action.ActionScoreUpdated||b instanceof a.core.board.action.ActionScoreAccumulated?this.actionUpdatePointsRenderer:null},b}();b.HardcodedActionRendererFactory=c}(b.render||(b.render={}));b.render}(a.core||(a.core={}));a.core}(ct||(ct={}));var ct;!function(a){!function(a){!function(a){!function(a){!function(a){var b=function(){function a(){}return a.prototype.render=function(a,b,c,d,e){var f=a,g=b,h=g.board,i=document.getElementById(h.id+"-time");i.textContent=f.secondsRemainingFormatted,e&&e()},a}();a.ActionTimeRemainingUpdatedRenderer=b}(a.action||(a.action={}));a.action}(a.board||(a.board={}));a.board}(a.render||(a.render={}));a.render}(a.core||(a.core={}));a.core}(ct||(ct={}));var ct;!function(a){!function(a){!function(a){!function(a){!function(a){var b=function(){function a(){}return a.prototype.render=function(a,b,c,d,e){var f=b,f=b,g=f.board,h=f.pointsSource.getPoints(f),i=document.getElementById(g.id+"-score");i.textContent=""+h,e&&e()},a}();a.ActionUpdatePointsRenderer=b}(a.action||(a.action={}));a.action}(a.board||(a.board={}));a.board}(a.render||(a.render={}));a.render}(a.core||(a.core={}));a.core}(ct||(ct={}));var ct;!function(a){!function(b){!function(b){!function(b){var c=function(){function b(a,b,c,d){this.gameState=a,this.homeGameState=b,this.div=c,this.headerHeight=d,this.mouseDown=!1}return b.prototype.countDown=function(b){var c=this,d=this.gameState.millisecondsRemaining;if(null!=d){var e;e=0>=d?this.homeGameState:null,this.actionHandler([new a.core.board.action.ActionTimeRemainingUpdated(this.gameState.secondsRemainingFormatted,this.gameState,null,b,e),new a.core.board.action.ActionScoreUpdated]),this.timerId=setTimeout(function(){c.countDown()},d%100+1)}},b.prototype.start=function(b){var c=this;this.actionHandler=b;var d=!0,e=function(e){var f=c.getTile(e);if(f){c.mouseDown=!0,console.log("mouse down!");var g=c.calculateSelectionStates([f.value]),h=new a.core.board.action.ActionSelectTile(f,g[0]);b([h]),d&&(c.countDown(new Date),d=!1)}},f=function(){if(c.mouseDown){c.mouseDown=!1;var d=c.actionTiles(c.gameState,c.gameState.selectedTileChain);for(var e in c.gameState.selectedTileChain){var f=c.gameState.selectedTileChain[e],g=new a.core.board.action.ActionDeselectTile(f);d.push(g)}b(d)}},g=function(d){if(c.mouseDown){var e=c.getTile(d);if(e){var f=c.gameState.selectedTileChain.indexOf(e);if(f>=0){if(f<c.gameState.selectedTileChain.length-1){for(var g=[],h=f+1;h<c.gameState.selectedTileChain.length;h++){var e=c.gameState.selectedTileChain[h],i=new a.core.board.action.ActionDeselectTile(e);g.push(i)}for(var j=[],h=0;f>=h;h++){var k=c.gameState.selectedTileChain[h];j.push(k)}for(var l=c.toValues(j),m=c.calculateSelectionStates(l),h=0;f>=h;h++){var k=j[h],n=m[h];if(n!=k.selectionState){var o=new a.core.board.action.ActionSetTileSelectionState(k,n);g.push(o)}}b(g)}}else if(c.gameState.selectedTileChain.length>0){var p=c.gameState.selectedTileChain[c.gameState.selectedTileChain.length-1];if(null!=p&&(p.position.x==e.position.x&&(p.position.y==e.position.y-1||p.position.y==e.position.y+1)||p.position.y==e.position.y&&(p.position.x==e.position.x-1||p.position.x==e.position.x+1))){var j=[];for(var q in c.gameState.selectedTileChain){var k=c.gameState.selectedTileChain[q];j.push(k)}j.push(e);for(var l=c.toValues(j),m=c.calculateSelectionStates(l),i=new a.core.board.action.ActionSelectTile(e,m[m.length-1]),g=[i],h=0;h<j.length-1;h++){var k=j[h],n=m[h];if(n!=k.selectionState){var o=new a.core.board.action.ActionSetTileSelectionState(k,n);g.push(o)}}b(g)}}}}};this.div.onmousedown=e,this.div.onmouseup=f,this.div.onmousemove=g,this.div.addEventListener("touchstart",function(a){e(a.touches[0]),a.preventDefault()}),this.div.addEventListener("touchmove",function(a){g(a.touches[0]),a.preventDefault()}),this.div.addEventListener("touchend",function(a){f(),a.preventDefault()})},b.prototype.stop=function(){this.div.onmousedown=null,this.div.onmouseup=null,this.div.onmousemove=null,null!=this.timerId&&(clearTimeout(this.timerId),this.timerId=null)},b.prototype.getTile=function(a){var b,c=a.clientX,d=a.clientY-this.headerHeight,e=this.gameState.board.tileWidth*this.gameState.board.tilesAcross,f=this.gameState.board.tileHeight*this.gameState.board.tilesDown;if(e>c&&f>d){var g=Math.floor(c/this.gameState.board.tileWidth),h=Math.floor(d/this.gameState.board.tileHeight);b=this.gameState.board.tiles[g][h]}else b=null;return b},b.prototype.calculateSelectionStates=function(a){var b=[];this.calculateSelectionStates2(a,b,!1);for(var c in a)b.push(3);return b},b.prototype.calculateSelectionStates2=function(a,b,c){var d;if(a.length>0){var e=a.splice(0,1),f=e[0],g=f.numberOfParams;d=!0;for(var h=b.length,i=0;g>i;i++)d=this.calculateSelectionStates2(a,b,!0)&&d;var j;c&&!f.evalReturnsNumber?(j=4,d=!1):j=d?2:1,b.splice(h,0,j)}else d=!1;return d},b.prototype.eval=function(a){if(a.length>0){for(var b=a.splice(0,1),c=b[0],d=c.numberOfParams,e=[],f=0;d>f;f++){var g=this.eval(a);e.push(g)}return c.eval(e)}throw"too short!"},b.prototype.toValues=function(a){var b=[];for(var c in a){var d=a[c];b.push(d.value)}return b},b.prototype.actionTiles=function(b,c){var d=[];try{var e=this.toValues(c),f=this.eval(e);if(e.length>0)throw"too long!";for(var g in c){var h=c[g],i=new a.core.board.action.ActionDestroyTile(h);d.push(i)}var j=[];if(null!=f){var k=c[0].value.terminate(c,this.gameState,f);for(var g in k){var i=k[g];if(i instanceof a.core.board.action.ActionCreateTile){var l=i;j.push(l.tile)}d.push(i)}}for(var m=b.tileSource.replace(b.board,c),n=0,o=0;o<this.gameState.board.tilesAcross;o++){for(var p=0,q=this.gameState.board.tilesDown;q>0;){q--;var h=this.gameState.board.tiles[o][q];if(null!=h){var r=c.indexOf(h);if(r>=0){var s=null;for(var g in j){var t=j[g];if(t.position.x==o&&t.position.y==q){s=g;break}}null!=s?h=j[s]:(p++,h=null)}if(null!=h&&p>0){var i=new a.core.board.action.ActionDropTile(h,o,q,q+p);d.push(i)}}}for(var u=0;p>u;u++){var h=m[n];n++;var i=new a.core.board.action.ActionDropTile(h,o,u-p,u);d.push(i)}}d.push(new a.core.board.action.ActionScoreUpdated)}catch(v){}return d},b}();b.BoardGameStateActionSource=c}(b.board||(b.board={}));b.board}(b.render||(b.render={}));b.render}(a.core||(a.core={}));a.core}(ct||(ct={}));var ct;!function(a){!function(b){!function(b){!function(b){var c=function(b){function c(a,c,d,e,f){b.call(this,a,c,d),this.headerHeight=e,this.homeGameState=f}return __extends(c,b),c.prototype.render=function(c,d){return b.prototype.render.call(this,c,d),new a.core.render.board.BoardGameStateActionSource(c,this.homeGameState,d,this.headerHeight)},c.prototype.doRender=function(a,c,d){var e=a,f=e.board,g=f.tilesAcross*f.tileWidth,h=f.tilesDown*f.tileHeight;d.boardWidth=g,d.boardHeight=h,d.tileWidth=f.tileWidth,d.tileHeight=f.tileHeight,b.prototype.doRender.call(this,a,c,d)},c}(a.core.render.HandlebarsGameStateRenderer);b.BoardGameStateRenderer=c}(b.board||(b.board={}));b.board}(b.render||(b.render={}));b.render}(a.core||(a.core={}));a.core}(ct||(ct={}));var ct;!function(a){!function(b){!function(b){!function(b){var c=function(a){function b(b,c,d,e){a.call(this,b,"opacity","0","1","",e),this.tileTemplate=c,this.tileColor=d
}return __extends(b,a),b.prototype.findOrCreateTarget=function(a,b){var c=b,d=a,e=c.board,f=d.tile,g=f.id,h=this.tileTemplate({tile:f,gameState:b,tileColor:this.tileColor}),i=this.parseSVG(h,g),j=document.getElementById(e.id+"-tiles");return j.appendChild(i),i},b}(a.core.render.HandlebarsSVGAnimationAttributeActionRenderer);b.HandlebarsSVGAnimationActionCreateTileRenderer=c}(b.board||(b.board={}));b.board}(b.render||(b.render={}));b.render}(a.core||(a.core={}));a.core}(ct||(ct={}));var ct;!function(a){!function(b){!function(b){!function(b){var c=function(a){function b(b,c,d,e){a.call(this,b,e),this.tileTemplate=c,this.tileColor=d}return __extends(b,a),b.prototype.setToFinalState=function(a,b,c){var d=b,e=a,f=d.board,g=e.column*f.tileWidth,h=e.toRow*f.tileHeight;c.setAttribute("transform","translate("+g+","+h+")")},b.prototype.findOrCreateTarget=function(a,b){var c=b,d=a,e=c.board,f=d.tile,g=f.id,h=document.getElementById(g);if(!h){var i=this.tileTemplate({tile:f,gameState:b,tileColor:this.tileColor});h=this.parseSVG(i,g);var j=document.getElementById(e.id+"-tiles");j.appendChild(h)}return h},b}(a.core.render.HandlebarsSVGAnimationActionRenderer);b.HandlebarsSVGAnimationActionDropTileRenderer=c}(b.board||(b.board={}));b.board}(b.render||(b.render={}));b.render}(a.core||(a.core={}));a.core}(ct||(ct={}));var ct;!function(a){!function(b){!function(b){!function(b){var c=function(a){function b(b,c,d,e,f,g,h,i){a.call(this,b,i),this.tileColor=c,this.validTileColor=d,this.invalidTileColor=e,this.extraneousTileColor=f,this.badParameterTileColor=g,this.idPostfix=h}return __extends(b,a),b.prototype.adjustParams=function(a,b,c){var d=a,e=d.originalSelectionState,f=d.newSelectionState,g=this.getColor(e),h=this.getColor(f);c.from=g,c.to=h,c.attributeName="fill"},b.prototype.getColor=function(a){var b;return b=2==a?this.validTileColor:1==a?this.invalidTileColor:3==a?this.extraneousTileColor:4==a?this.badParameterTileColor:this.tileColor},b.prototype.setToFinalState=function(a,b,c){var d=a,e=this.getColor(d.newSelectionState);c.setAttribute("fill",e)},b.prototype.findOrCreateTarget=function(a,b){var c=b,d=(c.board,a.getPrimaryId()+this.idPostfix),e=document.getElementById(d);return e},b}(a.core.render.HandlebarsSVGAnimationActionRenderer);b.HandlebarsSVGAnimationActionSetTileSelectionStateRenderer=c}(b.board||(b.board={}));b.board}(b.render||(b.render={}));b.render}(a.core||(a.core={}));a.core}(ct||(ct={}));var ct;!function(a){!function(b){!function(b){!function(b){var c=function(){function b(a,b){this.gameState=a,this.div=b}return b.prototype.start=function(b){var c=this;for(var d in this.gameState.levels){var e=function(){var e=c.gameState.levels[d],f=document.getElementById(e.id);f.onclick=function(){var c=[new a.core.home.action.ActionLevelSelect(e)];b(c)}};e()}},b.prototype.stop=function(){},b}();b.HomeGameStateActionSource=c}(b.home||(b.home={}));b.home}(b.render||(b.render={}));b.render}(a.core||(a.core={}));a.core}(ct||(ct={}));var ct;!function(a){!function(b){!function(b){!function(b){var c=function(b){function c(a,c,d,e,f){b.call(this,a,c,d),this.windowWidth=e,this.windowHeight=f}return __extends(c,b),c.prototype.render=function(c,d){b.prototype.render.call(this,c,d);var e=c;return new a.core.render.home.HomeGameStateActionSource(e,d)},c.prototype.doRender=function(a,c,d){var e=a,f=Math.max(2,Math.floor(this.windowWidth/300)),g=this.windowWidth/(f+1),h=(this.windowWidth-g*f)/(f+1),i=Math.min(g,(this.windowHeight-h)/(2*Math.ceil(e.levels.length/f)));for(var j in e.levels){var k=Math.floor(j/f),l=j%f,m=h*(l+1)+l*g,n=h*(k+1)+k*i,o=e.levels[j];o.position.x=m,o.position.y=n}d.windowWidth=this.windowWidth,d.windowHeight=this.windowHeight,d.selectionWidth=g,d.selectionHeight=i,d.selectionWidthDiv2=g/2,d.selectionHeightDiv2=i/2,d.fontSize=g/10,b.prototype.doRender.call(this,a,c,d)},c}(a.core.render.HandlebarsGameStateRenderer);b.HomeGameStateRenderer=c}(b.home||(b.home={}));b.home}(b.render||(b.render={}));b.render}(a.core||(a.core={}));a.core}(ct||(ct={}));